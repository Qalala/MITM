<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>LAN Secure Chat + MITM Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <h1>LAN Secure Chat + MITM Demo</h1>
      <div id="status"></div>

      <section id="role-section">
        <h2>1. Choose Role</h2>
        <select id="role-select">
          <option value="sender">Sender</option>
          <option value="receiver">Receiver</option>
          <option value="attacker">Attacker (MITM)</option>
        </select>
        <button id="set-role-btn">Set Role</button>
      </section>

      <section id="network-section">
        <h2>2. Network Setup</h2>
        <div>Local IP: <span id="local-ip">Loading...</span></div>
        <label
          >Transport:
          <select id="transport">
            <option value="tcp">TCP (1:1, default)</option>
            <option value="udp-broadcast">UDP broadcast (1:M, optional)</option>
          </select>
        </label>
        <div style="display: flex; gap: 8px; align-items: center;">
          <label>Target IP: <input id="target-ip" placeholder="enter target ip" style="width: 200px;" /></label>
          <button id="connect-btn" style="display: inline-block;">Connect</button>
        </div>
        <label>Port: <input id="target-port" value="12347" /></label>
        <div style="display: flex; gap: 8px; margin-top: 8px;">
          <button id="discover-btn">Auto discover</button>
          <button id="refresh-btn">Refresh</button>
        </div>
        <div id="discover-results" class="log" style="min-height:60px;max-height:120px;"></div>
        <div id="target-info" style="margin-top: 12px; padding: 8px; background: #2a2a2a; border-radius: 4px; display: none;">
          <strong style="color: #4a9eff;">Destination:</strong> <span id="target-display">Not set</span>
        </div>
      </section>

      <section id="security-section">
        <h2>3. Security</h2>
        <label
          >Encryption mode:
          <select id="enc-mode">
            <option value="0">0 - None (Plaintext)</option>
            <option value="1">1 - AES-GCM</option>
            <option value="2">2 - AES-CBC + HMAC-SHA256</option>
            <option value="3">3 - Diffie-Hellman (demo)</option>
          </select>
        </label>
        <label
          >Key exchange:
          <select id="kx-mode">
            <option value="psk">Pre-shared key</option>
            <option value="rsa">RSA</option>
            <option value="dh">Diffie-Hellman</option>
          </select>
        </label>
        <label>
          Pre-shared key (hex/string): 
          <input id="psk-input" placeholder="Enter PSK (required for encrypted modes)" />
          <span id="psk-required-indicator" style="color: #ff6b6b; font-size: 0.9em; margin-left: 8px; display: none;">‚ö† REQUIRED for sending encrypted messages</span>
        </label>
        <label><input type="checkbox" id="demo-mode" /> Demo mode (show steps)</label>
      </section>

      <section id="receiver-security-section">
        <h2>3. Decryption Configuration</h2>
        <p style="color: #9e9e9e; margin-bottom: 12px;">Select the decryption method this receiver will use. The receiver will only accept connections from senders using the same encryption mode.</p>
        <p style="color: #4caf50; font-size: 0.9em; margin-bottom: 12px; font-weight: bold; padding: 8px; background: #1a3a1a; border-radius: 4px;">
          ‚úÖ <strong>Receiver Mode:</strong> The receiver automatically listens for incoming connections. You do NOT need to enter a target IP - the receiver waits for senders or attackers to connect to it.
        </p>
        <label
          >Decryption mode:
          <select id="receiver-decrypt-mode">
            <option value="0">0 - Plaintext (No encryption)</option>
            <option value="1">1 - AES-GCM Decryption</option>
            <option value="2">2 - AES-CBC + HMAC-SHA256 Decryption</option>
            <option value="3">3 - Diffie-Hellman Decryption</option>
          </select>
        </label>
        <label
          >Key exchange:
          <select id="receiver-kx-mode">
            <option value="psk">Pre-shared key</option>
            <option value="rsa">RSA</option>
            <option value="dh">Diffie-Hellman</option>
          </select>
        </label>
        <label>
          Pre-shared key (hex/string): 
          <input id="receiver-psk-input" placeholder="Enter PSK (required for encrypted modes)" />
          <span id="receiver-psk-required-indicator" style="color: #ff6b6b; font-size: 0.9em; margin-left: 8px; display: none;">‚ö† REQUIRED for receiving encrypted messages</span>
        </label>
        <label><input type="checkbox" id="receiver-demo-mode" /> Demo mode (show steps)</label>
      </section>

      <section id="chat-section">
        <h2>4. Chat / Logs</h2>
        <div id="chat-log" class="log"></div>
        <div id="chat-input-row">
          <input id="chat-input" placeholder="Type message..." />
          <button id="send-btn">Send</button>
        </div>
      </section>

      <section id="attacker-section">
        <h2>Attacker Controls</h2>
        <div style="margin-bottom: 12px;">
          <h3 style="margin: 8px 0; color: #ff6b6b;">Victim Selection</h3>
          <p style="color: #9e9e9e; font-size: 0.9em; margin-bottom: 12px;">
            <strong>MITM Proxy Mode (Stealth):</strong> Enter the victim's (Receiver's) IP address in the Target IP field above.
            The attacker listens on all interfaces (like receiver) and is <strong>invisible to discovery</strong>.
            <strong>Sender connects to attacker's IP</strong> (shown in Local IP), attacker intercepts and forwards to receiver.
          </p>
          <p style="color: #4caf50; font-size: 0.85em; margin-bottom: 12px; font-weight: bold;">
            ‚úÖ Attacker is invisible - not discoverable by sender or receiver
          </p>
          <p style="color: #2196F3; font-size: 0.85em; margin-bottom: 12px; font-weight: bold;">
            üìç <strong>Connection Instructions:</strong> Sender must connect to <strong>Attacker's IP</strong> (shown in Local IP), NOT receiver's IP. Attacker will intercept and forward to receiver.
          </p>
          <button id="connect-to-receiver-btn" style="background: #4caf50; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; margin-right: 8px;">Connect to Receiver</button>
          <button id="start-attack-btn" style="background: #ff6b6b; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Start Attack</button>
        </div>
        <div style="margin-top: 16px;">
          <h3 style="margin: 8px 0; color: #ff6b6b;">Attack Configuration</h3>
          <label
            >Attack Mode:
            <select id="attack-mode">
              <option value="passive">Passive sniff/log (plaintext only)</option>
              <option value="modify">Modify plaintext</option>
              <option value="drop">Drop packets</option>
              <option value="delay">Delay packets</option>
              <option value="replay">Replay last</option>
              <option value="downgrade">Downgrade attempt</option>
            </select>
          </label>
          <div id="attack-options-container">
            <!-- Dynamic options will be shown here based on attack mode -->
            <div id="attack-options-passive" class="attack-options" style="display: none;">
              <p style="color: #9e9e9e; font-size: 0.9em; margin: 8px 0;">Passive mode: Will display plaintext messages only. Encrypted messages will show as encrypted.</p>
            </div>
            <div id="attack-options-modify" class="attack-options" style="display: none;">
              <label>Modify text: <input id="modify-text" placeholder="[MITM modified]" /></label>
              <p style="color: #9e9e9e; font-size: 0.9em; margin: 8px 0;">Will only modify plaintext messages. Encrypted messages cannot be modified.</p>
            </div>
            <div id="attack-options-drop" class="attack-options" style="display: none;">
              <label>Drop rate (%): <input id="drop-rate" type="number" value="0" min="0" max="100" /></label>
              <p style="color: #9e9e9e; font-size: 0.9em; margin: 8px 0;">Percentage of packets to drop randomly.</p>
            </div>
            <div id="attack-options-delay" class="attack-options" style="display: none;">
              <label>Delay (ms): <input id="delay-ms" type="number" value="0" min="0" /></label>
              <p style="color: #9e9e9e; font-size: 0.9em; margin: 8px 0;">Delay each packet by this amount.</p>
            </div>
            <div id="attack-options-replay" class="attack-options" style="display: none;">
              <p style="color: #9e9e9e; font-size: 0.9em; margin: 8px 0;">Will replay the last DATA frame. Secure modes with sequence numbers will block this.</p>
            </div>
            <div id="attack-options-downgrade" class="attack-options" style="display: none;">
              <p style="color: #9e9e9e; font-size: 0.9em; margin: 8px 0;">Attempts to downgrade encryption to plaintext. Will be blocked by receiver's mode mismatch check.</p>
            </div>
          </div>
        </div>
        <div id="attack-log" style="margin-top: 16px; padding: 8px; background: #1a1a1a; border-radius: 4px; min-height: 100px; max-height: 200px; overflow-y: auto;">
          <h4 style="margin: 0 0 8px 0; color: #ff6b6b;">Attack Log</h4>
          <div id="attack-log-content" style="color: #eaeaea; font-size: 0.9em;"></div>
        </div>
      </section>
    </div>

    <script src="main.js"></script>
  </body>
</html>


